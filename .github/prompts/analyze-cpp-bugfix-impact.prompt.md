---
description: 'C++14バグ修正の影響範囲を分析し、同様のパターンが存在する箇所を横にらみチェック'
mode: 'analyze-cpp-bugfix-impact'
tools: ['semantic_search', 'grep_search', 'read_file', 'list_code_usages']
model: 'claude-sonnet-4.5'
---

# C++バグ修正横にらみ分析

修正したC++14のバグについて、コードベース全体への影響を分析し、同様のパターンが存在する箇所を特定します。

## 📥 必須入力

- `${input:bugDescription}`: 修正したバグの説明
- `${input:fixedFile}`: 修正を行ったファイルパス
- `${input:fixedCode}`: 修正後のコード片(または修正内容の説明)

## 📋 実行ステップ

### ステップ 1: バグパターンの特定
1. 修正内容から以下を分析:
   - バグの根本原因(メモリ管理、並行処理、境界値等)
   - 問題のあったコードパターン
   - 修正で変更された要素(関数呼び出し、制御フロー等)

2. 検索すべきパターンを抽出:
   - 同じ関数/メソッドの使用箇所
   - 類似のコード構造
   - 同じクラス/テンプレートの使用パターン

### ステップ 2: 横にらみ検索
1. **セマンティック検索**で類似コードを検出
2. **grep検索**で具体的なパターンを検索:
   - 関数名、クラス名
   - 問題のあった制御構造
   - 特定のAPI使用パターン

3. **コード使用箇所の追跡**:
   - 修正した関数/メソッドの全使用箇所
   - 関連クラスの実装箇所

### ステップ 3: 影響範囲の評価
各検出箇所について:
1. 同じバグが存在する可能性を評価(高/中/低)
2. 修正の副作用が発生する可能性を評価
3. コンテキストを読み取り、問題の有無を判断

### ステップ 4: チェックリストレポート生成

以下の形式で出力:

```markdown
## 🔍 バグ修正横にらみチェックリスト

### 修正概要
- **ファイル**: [修正ファイル]
- **バグタイプ**: [メモリ管理/並行処理/境界値/その他]
- **根本原因**: [原因の説明]

### 🚨 要確認箇所(高優先度)
- [ ] [ファイルパス:行番号](リンク)
  - **パターン**: [検出されたパターン]
  - **リスク**: [同じバグが存在する理由]
  - **推奨**: [確認/修正の推奨事項]

### ⚠️ 確認推奨箇所(中優先度)
- [ ] [ファイルパス:行番号](リンク)
  - **パターン**: [類似パターンの説明]
  - **リスク**: [潜在的な問題]

### 💡 参考情報(低優先度)
- [ ] [ファイルパス:行番号](リンク)
  - **メモ**: [関連性の説明]

### 🔄 修正による影響範囲
- **直接影響**: [修正したコードを直接使用している箇所]
- **間接影響**: [影響を受ける可能性のある箇所]
- **テスト推奨**: [テストすべき機能やシナリオ]

### 📊 検索サマリー
- 検索実行数: X回
- 検出箇所総数: Y箇所
- 要確認(高): A箇所
- 要確認(中): B箇所
- 参考(低): C箇所
```

## ✅ 成功基準

- [ ] バグパターンを正確に特定
- [ ] 少なくとも3種類の検索方法を実施
- [ ] 各検出箇所にリスク評価を付与
- [ ] チェックリスト形式で出力
- [ ] ファイルリンクが正しく設定

## 💡 ベストプラクティス

1. **段階的な検索**: 広範囲→具体的な順で検索
2. **偽陽性の考慮**: コンテキストを読んで判断
3. **優先度付け**: 高リスクを明確に
4. **実行可能性**: チェックリストが実際に使える形に

## 📚 参考

詳細なC++分析ガイドライン: [インストラクション](../instructions/analyze-cpp-bugfix-impact.instructions.md)

C++並行処理ガイド: [インストラクション](../instructions/analyze-cpp-concurrency.instructions.md)
