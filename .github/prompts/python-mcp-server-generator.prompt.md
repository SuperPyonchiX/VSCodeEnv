---
mode: 'agent'
description: 'ツール、リソース、適切な設定を持つ完全なPythonのMCPサーバープロジェクトを生成'
---

# Python MCPサーバーの生成

以下の仕様で完全なModel Context Protocol (MCP)サーバーをPythonで作成します：

## 要件

1. **プロジェクト構造**: uvを使用して適切な構造で新しいPythonプロジェクトを作成
2. **依存関係**: uvでmcp[cli]パッケージを含める
3. **トランスポートタイプ**: stdio（ローカル用）またはstreamable-http（リモート用）から選択
4. **ツール**: 適切な型ヒント付きの少なくとも1つの有用なツールを作成
5. **エラーハンドリング**: 包括的なエラーハンドリングと検証を含める

## 実装詳細

### プロジェクトセットアップ
- `uv init project-name` で初期化
- MCP SDKを追加: `uv add "mcp[cli]"`
- メインサーバーファイルを作成（例: `server.py`）
- Pythonプロジェクト用の `.gitignore` を追加
- `if __name__ == "__main__"` で直接実行できるように設定

### サーバー設定
- `mcp.server.fastmcp` から `FastMCP` クラスを使用
- サーバー名とオプションの指示を設定
- トランスポートを選択: stdio（デフォルト）またはstreamable-http
- HTTP用: オプションでホスト、ポート、ステートレスモードを設定

### ツール実装
- 関数に `@mcp.tool()` デコレータを使用
- 常に型ヒントを含める - これらはスキーマを自動生成します
- 明確なdocstringを書く - これらがツールの説明になります
- 構造化された出力にPydanticモデルまたはTypedDictを使用
- I/Oバウンドタスクに非同期操作をサポート
- 適切なエラーハンドリングを含める

### リソース/プロンプトセットアップ（オプション）
- `@mcp.resource()` デコレータでリソースを追加
- 動的リソースにはURIテンプレートを使用: `"resource://{param}"`
- `@mcp.prompt()` デコレータでプロンプトを追加
- プロンプトから文字列またはMessageリストを返す

### コード品質
- すべての関数パラメータと戻り値に型ヒントを使用
- ツール、リソース、プロンプトにdocstringを書く
- PEP 8スタイルガイドラインに従う
- 非同期操作にasync/awaitを使用
- リソースクリーンアップにコンテキストマネージャーを実装
- 複雑なロジックにインラインコメントを追加

## 検討すべきツールタイプの例
- データ処理と変換
- ファイルシステム操作（読み取り、分析、検索）
- 外部API統合
- データベースクエリ
- テキスト分析または生成（サンプリング付き）
- システム情報取得
- 数学または科学計算

## 設定オプション
- **stdioサーバーの場合**:
  - シンプルな直接実行
  - `uv run mcp dev server.py` でテスト
  - Claudeにインストール: `uv run mcp install server.py`
  
- **HTTPサーバーの場合**:
  - 環境変数によるポート設定
  - スケーラビリティのためのステートレスモード: `stateless_http=True`
  - JSONレスポンスモード: `json_response=True`
  - ブラウザクライアント用のCORS設定
  - 既存のASGIサーバー（Starlette/FastAPI）へのマウント

## テストガイダンス
- サーバーの実行方法を説明:
  - stdio: `python server.py` または `uv run server.py`
  - HTTP: `python server.py` を実行してから `http://localhost:PORT/mcp` に接続
- MCP Inspectorでテスト: `uv run mcp dev server.py`
- Claude Desktopにインストール: `uv run mcp install server.py`
- ツール呼び出しの例を含める
- トラブルシューティングのヒントを追加

## 検討すべき追加機能
- ログ記録、進捗、通知のためのContext使用
- AIパワードツールのためのLLMサンプリング
- インタラクティブワークフローのためのユーザー入力要求
- 共有リソース（データベース、接続）のためのLifespan管理
- Pydanticモデルによる構造化出力
- UI表示用のアイコン
- Imageクラスによる画像処理
- より良いUXのための補完サポート

## ベストプラクティス
- どこでも型ヒントを使用 - オプションではありません
- 可能な限り構造化データを返す
- stdoutの汚染を避けるためにstderrにログ記録（またはContextログ記録を使用）
- リソースを適切にクリーンアップ
- 早期に入力を検証
- 明確なエラーメッセージを提供
- LLM統合前にツールを独立してテスト

型安全性、適切なエラーハンドリング、包括的なドキュメントを備えた、完全で本番環境対応のMCPサーバーを生成します。
