---

description: "リポジトリ用のAGENTS.mdファイルを生成するプロンプト"
mode: "agent"
---

# 高品質なAGENTS.mdファイルの作成

あなたはコードエージェントです。あなたのタスクは、https://agents.md/ および https://code.visualstudio.com/docs/copilot/customization/custom-agents の公式ガイダンスに従って、このリポジトリのルートに完全で正確なAGENTS.mdを作成することです。

AGENTS.mdは、コーディングエージェントがプロジェクトで効果的に作業するために必要なコンテキストと指示を提供するように設計されたオープンフォーマットです。VS Codeでは、より高度な機能(カスタムエージェント、ハンドオフ、ツール管理)を活用できる.agent.mdフォーマットもサポートしています。

## AGENTS.mdとは?

AGENTS.mdは「エージェントのためのREADME」として機能するMarkdownファイルで、AIコーディングエージェントがプロジェクトで作業するのを支援するためのコンテキストと指示を提供する専用の予測可能な場所です。README.mdを補完し、コーディングエージェントが必要とする詳細な技術的コンテキストを含みますが、人間向けのREADMEを混雑させることはありません。

### VS Code固有の拡張機能

VS Codeでは、AGENTS.mdの基本概念に加えて、より高度なカスタムエージェント機能を提供しています:

- **.agent.mdファイル**: VS Code専用のカスタムエージェント定義ファイル
- **ハンドオフ機能**: エージェント間のシームレスな遷移とワークフローの構築
- **ツール管理**: 特定のタスクに必要なツールのみを指定
- **モデル選択**: エージェントごとに最適なAIモデルを指定
- **ユーザープロファイル**: ワークスペース全体で再利用可能なエージェント定義

## 重要原則

- **エージェント重視**: 自動化ツール向けの詳細な技術的指示を含む
- **README.mdを補完**: 人間向けドキュメントを置き換えるのではなく、エージェント固有のコンテキストを追加
- **標準化された場所**: リポジトリルート（またはモノレポの場合はサブプロジェクトルート）に配置
- **オープンフォーマット**: 柔軟な構造で標準的なMarkdownを使用
- **エコシステム互換性**: 20以上の異なるAIコーディングツールとエージェントで動作
- **VS Code拡張性**: VS Code環境では.agent.mdファイルでより高度な機能を活用可能

## ファイル構造とコンテンツガイドライン

### 0. ファイルフォーマットの選択

プロジェクトとツールのニーズに応じて、適切なフォーマットを選択します:

#### AGENTS.md (汎用フォーマット)
- **用途**: 20以上のAIコーディングツール(Cursor、Aider、Gemini CLI、Factory、Jules等)で動作
- **場所**: リポジトリルートに配置
- **フォーマット**: 標準的なMarkdown
- **推奨**: 汎用性が必要な場合、または複数のツールをサポートする場合

#### .agent.md (VS Code専用フォーマット)
- **用途**: VS Code GitHub Copilot専用の高度な機能を活用
- **場所**: `.github/agents/` フォルダーまたはユーザープロファイル
- **フォーマット**: YAMLフロントマター + Markdown本文
- **推奨**: VS Code環境で高度な機能(ハンドオフ、ツール管理、モデル選択)が必要な場合

**両方を作成することも可能**: AGENTS.mdで汎用的な基本情報を提供し、.agent.mdでVS Code固有の高度な機能を追加

### 1. 必須セットアップ

#### AGENTS.mdの場合
- リポジトリルートに `AGENTS.md` としてファイルを作成
- 標準的なMarkdownフォーマットを使用
- 必須フィールドなし - プロジェクトのニーズに基づく柔軟な構造

#### .agent.mdの場合 (VS Code)
- `.github/agents/` フォルダーまたはユーザープロファイルにファイルを作成
- ファイル名は `.agent.md` 拡張子を使用 (例: `planner.agent.md`)
- YAMLフロントマターで設定を定義
- Markdown本文で指示を記述

### 1.1. VS Code .agent.md フロントマター設定 (オプション)

YAMLフロントマターで以下のフィールドを設定できます:

| フィールド | 説明 | 必須 |
|----------|------|------|
| `description` | エージェントの簡単な説明(チャット入力フィールドにプレースホルダーとして表示) | いいえ |
| `name` | エージェントの名前(指定しない場合はファイル名を使用) | いいえ |
| `argument-hint` | ユーザーへのヒントテキスト | いいえ |
| `tools` | 使用可能なツールまたはツールセットのリスト | いいえ |
| `model` | 使用するAIモデル(Claude Sonnet 4、GPT-4等) | いいえ |
| `target` | ターゲット環境(`vscode` または `github-copilot`) | いいえ |
| `handoffs` | 他のエージェントへの遷移定義(ハンドオフ) | いいえ |

**handoffs の詳細設定**:
- `label`: ハンドオフボタンに表示されるテキスト
- `agent`: 遷移先のエージェント識別子
- `prompt`: 遷移先に送信するプロンプトテキスト
- `send`: プロンプトを自動送信するかどうか(デフォルト: false)

**フロントマター例**:
```yaml
---
description: 実装計画を生成します
name: Planner
tools: ['fetch', 'githubRepo', 'search', 'usages']
model: Claude Sonnet 4
handoffs:
  - label: 実装を開始
    agent: implementation
    prompt: 上記の計画を実装してください。
    send: false
---
```

### 2. 含めるべき必須セクション

#### プロジェクト概要

- プロジェクトが何を行うかの簡単な説明
- 複雑な場合はアーキテクチャ概要
- 使用されている主要な技術とフレームワーク

#### セットアップコマンド

- インストール手順
- 環境セットアップ手順
- 依存関係管理コマンド
- 該当する場合はデータベースセットアップ

#### 開発ワークフロー

- 開発サーバーの起動方法
- ビルドコマンド
- ウォッチ/ホットリロードのセットアップ
- パッケージマネージャーの詳細（npm、pnpm、yarnなど）

#### テスト手順

- テストの実行方法（ユニット、統合、e2e）
- テストファイルの場所と命名規則
- カバレッジ要件
- 使用される特定のテストパターンまたはフレームワーク
- テストのサブセットを実行する方法または特定の領域に焦点を当てる方法

#### コードスタイルガイドライン

- 言語固有の規則
- リンティングとフォーマットのルール
- ファイル構成パターン
- 命名規則
- インポート/エクスポートパターン

#### ビルドとデプロイメント

- ビルドコマンドと出力
- 環境設定
- デプロイメント手順と要件
- CI/CDパイプライン情報

### 3. オプションだが推奨されるセクション

#### セキュリティ考慮事項

- セキュリティテスト要件
- シークレット管理
- 認証パターン
- 権限モデル

#### モノレポ手順（該当する場合）

- 複数のパッケージでの作業方法
- パッケージ間依存関係
- 選択的なビルド/テスト
- パッケージ固有のコマンド

#### プルリクエストガイドライン

- タイトルのフォーマット要件
- 提出前の必須チェック
- レビュープロセス
- コミットメッセージの規則

#### デバッグとトラブルシューティング

- 一般的な問題と解決策
- ログパターン
- デバッグ設定
- パフォーマンス考慮事項

## テンプレート例

### AGENTS.md テンプレート (汎用)

これを開始テンプレートとして使用し、特定のプロジェクトに基づいてカスタマイズします：

```markdown
# AGENTS.md

## プロジェクト概要

[プロジェクトの簡単な説明、その目的、および主要な技術]

## セットアップコマンド

- 依存関係のインストール: `[パッケージマネージャー] install`
- 開発サーバーの起動: `[コマンド]`
- 本番環境用ビルド: `[コマンド]`

## 開発ワークフロー

- [開発サーバー起動手順]
- [ホットリロード/ウォッチモード情報]
- [環境変数セットアップ]

## テスト手順

- すべてのテストを実行: `[コマンド]`
- ユニットテストを実行: `[コマンド]`
- 統合テストを実行: `[コマンド]`
- テストカバレッジ: `[コマンド]`
- [特定のテストパターンまたは要件]

## コードスタイル

- [言語とフレームワークの規則]
- [リンティングルールとコマンド]
- [フォーマット要件]
- [ファイル構成パターン]

## ビルドとデプロイメント

- [ビルドプロセス詳細]
- [出力ディレクトリ]
- [環境固有のビルド]
- [デプロイメントコマンド]

## プルリクエストガイドライン

- タイトルフォーマット: [コンポーネント] 簡単な説明
- 必須チェック: `[リントコマンド]`、`[テストコマンド]`
- [レビュー要件]

## 追加注記

- [プロジェクト固有のコンテキスト]
- [一般的な落とし穴やトラブルシューティングのヒント]
- [パフォーマンス考慮事項]
```

### .agent.md テンプレート (VS Code専用)

VS Codeで高度な機能を活用する場合のテンプレート:

```markdown
---
description: '新機能の実装計画を生成します'
name: 'Planner'
tools: ['fetch', 'githubRepo', 'search', 'usages']
model: 'Claude Sonnet 4'
handoffs:
  - label: '実装を開始'
    agent: 'implementation'
    prompt: '上記の計画を実装してください。'
    send: false
  - label: 'コードレビュー'
    agent: 'reviewer'
    prompt: '実装コードをレビューしてください。'
    send: false
---

# プランニング指示

あなたはプランニングモードです。新機能の実装計画またはコードリファクタリング計画を生成してください。

## タスク

実装計画は以下のセクションを含むMarkdownドキュメントです:

* **概要**: 機能またはリファクタリングタスクの簡単な説明
* **要件**: 機能またはリファクタリングタスクの要件リスト
* **実装ステップ**: 実装の詳細なステップリスト
* **テスト**: 機能を検証するために必要なテストのリスト

## 制約

- コード編集は行わず、計画のみを生成してください
- 読み取り専用ツールのみを使用してください
- 実装の詳細は次のステップ(実装エージェント)に任せてください
```

## 実用例

### agents.mdからの実用例

agents.mdウェブサイトからの実際の例です：

```markdown
# サンプルAGENTS.mdファイル

## 開発環境のヒント

- `ls`でスキャンする代わりに、`pnpm dlx turbo run where <project_name>`を使用してパッケージにジャンプします。
- `pnpm install --filter <project_name>`を実行して、Vite、ESLint、TypeScriptが認識できるようにパッケージをワークスペースに追加します。
- `pnpm create vite@latest <project_name> -- --template react-ts`を使用して、TypeScriptチェックの準備ができた新しいReact + Viteパッケージを作成します。
- 各パッケージのpackage.json内のnameフィールドを確認して正しい名前を確認します—トップレベルのものはスキップします。

## テスト手順

- .github/workflowsフォルダーでCIプランを見つけます。
- `pnpm turbo run test --filter <project_name>`を実行して、そのパッケージに定義されているすべてのチェックを実行します。
- パッケージルートから単に`pnpm test`を呼び出すことができます。マージする前にコミットはすべてのテストに合格する必要があります。
- 1つのステップに焦点を当てるには、Vitestパターンを追加します：`pnpm vitest run -t "<test name>"`。
- スイート全体がグリーンになるまで、テストまたは型エラーを修正します。
- ファイルを移動したりインポートを変更したりした後、`pnpm lint --filter <project_name>`を実行して、ESLintとTypeScriptのルールがまだ合格することを確認します。
- 誰も頼まなくても、変更したコードのテストを追加または更新します。

## PR手順

- タイトルフォーマット: [<project_name>] <タイトル>
- コミット前に必ず`pnpm lint`と`pnpm test`を実行します。
```

### VS Code .agent.mdからの実用例

VS Codeドキュメントからのプランナーエージェントの例:

```markdown
---
description: '新機能やリファクタリング既存コードの実装計画を生成します'
name: 'Planner'
tools: ['fetch', 'githubRepo', 'search', 'usages']
model: 'Claude Sonnet 4'
handoffs:
  - label: 'プランを実装'
    agent: 'agent'
    prompt: '上記のプランを実装してください。'
    send: false
---

# プランニング指示

あなたはプランニングモードです。新機能の実装計画または既存コードのリファクタリング計画を生成するのがあなたのタスクです。

コード編集は行わず、計画のみを生成してください。

計画は以下のセクションを含むMarkdownドキュメントです:

* 概要: 機能またはリファクタリングタスクの簡単な説明
* 要件: 機能またはリファクタリングタスクの要件リスト
* 実装ステップ: 機能またはリファクタリングタスクを実装するための詳細なステップリスト
* テスト: 機能またはリファクタリングタスクを検証するために実装する必要があるテストのリスト
```

### ハンドオフワークフローの実用例

複数のエージェントを連携させる例:

**1. planner.agent.md** (計画生成)
```markdown
---
description: '実装計画を生成'
tools: ['search', 'fetch']
handoffs:
  - label: '実装を開始'
    agent: 'implementation'
    prompt: 'この計画を実装してください。'
---
# 計画を生成し、コード編集は行わない
```

**2. implementation.agent.md** (実装)
```markdown
---
description: '計画に基づいて実装'
tools: ['search', 'fetch', 'edit', 'create']
handoffs:
  - label: 'コードレビュー'
    agent: 'reviewer'
    prompt: '実装をレビューしてください。'
---
# 計画に従って実装する
```

**3. reviewer.agent.md** (レビュー)
```markdown
---
description: 'セキュリティと品質をレビュー'
tools: ['search', 'fetch']
---
# セキュリティ脆弱性と改善点を特定する
```

## 実装ステップ

### AGENTS.md作成の場合

1. **プロジェクト構造を分析**して理解する：

   - 使用されているプログラミング言語とフレームワーク
   - パッケージマネージャーとビルドツール
   - テストフレームワーク
   - プロジェクトアーキテクチャ（モノレポ、単一パッケージなど）

2. **主要なワークフローを特定**するために次を調査：

   - package.jsonスクリプト
   - Makefileまたは他のビルドファイル
   - CI/CD設定ファイル
   - ドキュメントファイル

3. **包括的なセクションを作成**して次をカバー：

   - すべての必須セットアップと開発コマンド
   - テスト戦略とコマンド
   - コードスタイルと規則
   - ビルドとデプロイメントプロセス

4. **エージェントが直接実行できる具体的で実行可能なコマンドを含める**

5. **指示をテスト**して、すべてのコマンドがドキュメント通りに機能することを確認

6. **エージェントが知る必要があることに焦点を当てる**、一般的なプロジェクト情報ではなく

### .agent.md作成の場合 (VS Code)

1. **エージェントの役割を定義**：
   - プランニング、実装、レビュー、テストなど、エージェントの特定の役割を決定
   - 各役割に必要なツールセットを特定

2. **フロントマターを設定**：
   - `description`: エージェントの簡潔な説明
   - `tools`: 必要なツールのみをリスト化(最小権限の原則)
   - `model`: タスクに最適なAIモデルを選択
   - `handoffs`: 次のステップへの遷移を定義

3. **指示を記述**：
   - エージェントが実行すべき具体的なタスクを明確に定義
   - 制約や禁止事項を明示(例: 「コード編集は行わない」)
   - 期待される出力形式を説明

4. **ワークフローを設計**：
   - 複数のエージェント間の流れを考慮
   - handoffsを使用して次のステップを明示
   - 各エージェントの責任範囲を明確化

5. **テストと検証**：
   - VS Codeでエージェントを実行してテスト
   - ハンドオフが正しく機能することを確認
   - ツールの制限が適切に機能することを確認

## ベストプラクティス

### 共通のベストプラクティス

- **具体的にする**: 漠然とした説明ではなく、正確なコマンドを含める
- **コードブロックを使用**: 明確さのためにコマンドをバックティックで囲む
- **コンテキストを含める**: 特定のステップが必要な理由を説明
- **最新に保つ**: プロジェクトの進化に合わせて更新
- **コマンドをテスト**: リストされたすべてのコマンドが実際に機能することを確認
- **ネストされたファイルを考慮**: モノレポの場合、必要に応じてサブプロジェクトにAGENTS.mdファイルを作成

### VS Code .agent.md 固有のベストプラクティス

- **ツールの最小化**: 各エージェントに必要最小限のツールのみを提供(最小権限の原則)
- **ハンドオフの設計**: 論理的なワークフローで次のステップを明確に示す
- **役割の明確化**: 各エージェントの責任範囲を明確に定義し、重複を避ける
- **モデルの最適化**: タスクに応じて最適なAIモデルを選択(例: 複雑な計画にはClaude Sonnet 4)
- **制約の明示**: エージェントが行ってはいけないことを明確に指定
- **send: false の活用**: ハンドオフでは通常 `send: false` を使用し、ユーザーがプロンプトを確認できるようにする
- **ツール参照の活用**: 本文中で `#tool:<tool-name>` 構文を使用してツールを参照
- **他のファイルの参照**: Markdownリンクを使用して指示ファイルを再利用

### ハンドオフのベストプラクティス

- **段階的なワークフロー**: プランニング → 実装 → レビュー のような明確なフローを作成
- **コンテキストの継承**: 前のステップの情報を次のステップに適切に渡す
- **レビューポイントの設置**: 重要な変更前にユーザーの確認を促す
- **フェイルセーフテスト**: 実装前にテストを生成し、レビューしやすくする

## モノレポ考慮事項

大規模なモノレポの場合：

- リポジトリルートにメインのAGENTS.mdを配置
- サブプロジェクトディレクトリに追加のAGENTS.mdファイルを作成
- 最も近いAGENTS.mdファイルが任意の場所に対して優先される
- パッケージ/プロジェクト間のナビゲーションのヒントを含める

## 最終注記

### AGENTS.md (汎用フォーマット)

- AGENTS.mdはCursor、Aider、Gemini CLI、Factory、Julesなどの20以上のAIコーディングツールで動作します
- フォーマットは意図的に柔軟です - プロジェクトのニーズに合わせて適応させます
- 実行可能な指示に焦点を当て、エージェントがコードベースを理解して作業するのを支援します
- これは生きたドキュメントです - プロジェクトが進化するにつれて更新します

### .agent.md (VS Code専用)

- VS Code GitHub Copilotで高度な機能を活用できます
- ハンドオフ機能により、複数のエージェント間でシームレスなワークフローを構築できます
- ツール管理により、各タスクに最適な権限セットを提供できます
- 既存の.chatmode.mdファイルは自動的に認識され、Quick Fixで.agent.mdに移行できます
- `.github/agents/` フォルダー内の.mdファイルは自動的にカスタムエージェントとして検出されます

### 統合アプローチ

両方のフォーマットを活用することを検討してください:
- **AGENTS.md**: リポジトリルートに配置し、汎用的なプロジェクト情報を提供
- **.agent.md**: VS Code固有の高度なワークフローとエージェント定義を提供

この統合アプローチにより、幅広いツールのサポートとVS Code固有の強力な機能の両方を実現できます。

## 参考資料

- **AGENTS.md 公式サイト**: https://agents.md/
- **VS Code カスタムエージェント**: https://code.visualstudio.com/docs/copilot/customization/custom-agents
- **Awesome Copilot リポジトリ**: https://github.com/github/awesome-copilot (コミュニティ貢献の例)

## タスク完了基準

AGENTS.mdファイルを作成する際は、明確さ、完全性、実行可能性を優先します。目標は、任意のコーディングエージェントに、追加の人間のガイダンスを必要とせずにプロジェクトに効果的に貢献するのに十分なコンテキストを提供することです。

VS Code .agent.mdファイルを作成する場合は、さらに以下を確認してください:
- フロントマターが適切に設定されている
- ツールが必要最小限に制限されている
- ハンドオフが論理的なワークフローを形成している
- 各エージェントの役割が明確に定義されている
